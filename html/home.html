<!doctype html>
<html lang="en" ng-app="myapp">

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
        content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <link rel="stylesheet" href="../css/mainscript.css">
    <link rel="stylesheet" href="../css/bootstrap-5.3.0-alpha1-dist/css/bootstrap.min.css">
    <script src="../js/angular-1.8.2/angular.js"></script>
    <script src="../js/popper.js"></script>
    <script src="../js/angular-1.8.2/angular-route.js"></script>
    <script src='https://rawgit.com/ghostbar/angular-file-model/master/angular-file-model.js'></script>
</head>

<body>
    <div>
        <div class="mainx">
            <!--header-->
            <nav class="navbar navbar-expand-lg bg-body-tertiary">
                <div class="container-fluid row" style="justify-content: space-between">
                    <h1 class="col-2" href="#">Innisfree</h1>
                    <form class="d-flex col-3" role="search">
                        <input class="form-control me-2" type="search" placeholder="Search" aria-label="Search">
                        <button class="btn btn-outline-success" type="submit">Search</button>
                    </form>

                    <div class="col-4"></div>
                    <div class="collapse navbar-collapse col-3 navbar-end" id="navbarSupportedContent">
                        <ul class="navbar-nav me-auto mb-2 mb-lg-0 row">
                            <li class="nav-item col-4">
                                <a href="#sign">đăng nhập</a>
                            </li>
                            <li class="nav-item col-4">
                                <a class="nav-link" href="#">trang của tôi</a>
                            </li>
                            <li class="nav-item col-4">
                                <a href="#cart">giỏ hàng</a>
                            </li>
                        </ul>
                    </div>
                    <button class="navbar-toggler col-1" type="button" data-bs-toggle="collapse"
                        data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent"
                        aria-expanded="false" aria-label="Toggle navigation">
                        <span class="navbar-toggler-icon"></span>
                    </button>
                </div>
            </nav>
            <div class="row mt-3 mb-5">
                <div class="col-2"><a href="#index">Trang chủ</a></div>
                <div class="col-2"><a href="#product">sp</a></div>
                <div class="col-2"><a href="#storeinfo">Giới thiệu cửa hàng</a></div>
                <div class="col-2"><a href="#event">sự kiện</a></div>
            </div>
            <div ng-view></div>

            <!--footer-->
            <div class="footerx">
                <div class="the-real-footer">
                    <div class="row footer-first-row">
                        <div class="col-8" style="text-align: start">
                            <div class="row">
                                <h1 style="color: white">innisfree</h1>
                            </div>
                            <div class="row mt-5">
                                <div class="col-1">
                                    <button class="footer-button">a</button>
                                </div>
                                <div class="col-1">
                                    <button class="footer-button">a</button>
                                </div>
                                <div class="col-1">
                                    <button class="footer-button">a</button>
                                </div>
                                <div class="col-1">
                                    <button class="footer-button">a</button>
                                </div>
                            </div>
                        </div>
                        <div class="col-4" style="text-align: end;padding: 4% 0">
                            <div class="row">
                                <div class="col-2"><button class="footer-button">a</button></div>
                                <div class="col-10">
                                    <div class="row footer-button-text">2020 innisfree Inc.</div>
                                    <div class="row footer-button-text">All rights reserved.</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="row">
                            <div class="col-2" style="width: fit-content"><a class="footer-button-text">Chính sách giao
                                    hàng
                                    và thanh toán</a></div>
                            <div class="col-2" style="width: fit-content"><a class="footer-button-text">Chính sách bảo
                                    mật
                                    thông tin khách hàng</a></div>
                            <div class="col-2" style="width: fit-content"><a class="footer-button-text">Chính sách mua
                                    hàng</a></div>
                            <div class="col-2" style="width: fit-content"><a class="footer-button-text">Chính sách trả
                                    hàng</a></div>
                        </div>
                        <div class="row">
                            <p class="footer-button-text">thời gian làm việc: Thứ 2 đến thứ 7 hàng tuần</p>
                            <p class="footer-button-text">Tự vấn và chăm sóc khách hàng: 129310923890182390 (Ext 125)
                            </p>
                            <p class="footer-button-text">Email: cs_vn@tinhte.innisfree.com</p>
                        </div>
                    </div>
                    <div class="row">

                    </div>
                </div>
            </div>
        </div>
    </div>
</body>

<!-- <script src="../controller/addcategory.js"></script>
<script src="../controller/addproduct.js"></script>
<script src="../controller/cart.js"></script>
<script src="../controller/detailproduct.js"></script>
<script src="../controller/signin.js"></script> -->

<script>
    const app = angular.module("myapp",["ngRoute", "file-model"])

    app.controller = ('AddCategory', ($scope, $http) => {
        const categoryApi = 'http://localhost:3000/categories'

        $scope.updateIndex = -1;
        $http.get(categoryApi)
            .then((res) => {
                $scope.listCategories = res.data;
            })

        $scope.category = {
            id: 0,
            name: ''
        }

        $scope.submit = (e) => {
            e.preventDefault();
            $scope.insert()
            // $scope.update()
        }

        $scope.insert = () => {
            $http.post(categoryApi, $scope.category, JSON.stringify($scope.category))
                .then(res => {
                    console.dir(res);
                })
            $http.get(categoryApi)
                .then((res) => {
                    $scope.listCategories = res.data;
                })
            $scope.category = {
                id: 0,
                name: ''
            }

            $scope.update = () => {
                $http.patch(categoryApi.concat(`/${$scope.updateIndex}`), $scope.category, JSON.stringify($scope.category))
                    .then(res => {
                        console.dir(res);
                    })
                $http.get(categoryApi)
                    .then((res) => {
                        $scope.listCategories = res.data;
                    })
                $scope.updateIndex = -1;
            }

            $scope.category = {
                id: 0,
                name: '',
            }

            $scope.handleUpdate = (e, id) => {
                console.log(id);
                e.preventDefault();
                $scope.updateIndex = id;
                $scope.listCategories.map(cat => {
                    if (cat.id === id) {
                        $scope.category = cat;
                        return;
                    }
                })
            }
        }
    })


    app.controller = ('AddProduct', ($scope, $http) => {
        const productApi = 'http://localhost:3000/products'
        const categoryApi = 'http://localhost:3000/categories'

        $scope.file = null;
        $scope.fileLink = "";

        $scope.updateIndex = -1;

        $scope.submit = (e) => {
            e.preventDefault();
            // $scope.insert()
            $scope.update()
        }

        $scope.insert = () => {
            $http.post(productApi, $scope.product, JSON.stringify($scope.product))
                .then(res => {
                    console.dir(res);
                })
            $http.get(productApi)
                .then((res) => {
                    $scope.listProducts = res.data;
                })
            $scope.product = {
                id: 0,
                name: '',
                price: 0,
                category: 0,
                img: ''
            }
        }

        $scope.update = () => {
            $http.patch(productApi.concat(`/${$scope.updateIndex}`), $scope.product, JSON.stringify($scope.product))
                .then(res => {
                    console.dir(res);
                })
            $http.get(productApi)
                .then((res) => {
                    $scope.listProducts = res.data;
                })
            $scope.updateIndex = -1;
        }

        $scope.product = {
            id: 0,
            name: '',
            price: 0,
            category: 0,
            img: ''
        }

        $http.get(productApi)
            .then((res) => {
                $scope.listProducts = res.data;
                $scope.listProducts.map(pro => {
                    console.log(pro);
                })
            })

        $http.get(categoryApi)
            .then((res) => {
                $scope.listCategory = res.data;
            })

        $scope.handleUpdate = (e, id) => {
            $scope.updateIndex = id;
            $scope.listProducts.map((pro) => {
                if (pro.id === id) {
                    // $scope.updateProduct = pro;
                    $scope.product = pro;
                    return;
                }
            })
        }

        $scope.$watch('file', (newVal) => {
            if (newVal) {
                console.log(newVal);
            }
        })

        $scope.handleFile = e => {
            console.dir(e)
        }

        $scope.handleDelete = (e, id) => {
            e.preventDefault()
            $http.delete(productApi.concat(`/${id}`))
            $http.get(productApi)
                .then((res) => {
                    $scope.listProducts = res.data;
                })
        }
    })


    app.controller = ('Cart', ($scope, $http) => {
        const productApi = 'http://localhost:3000/products'
        const cartApi = 'http://localhost:3000/carts'
        const categoryApi = 'http://localhost:3000/categories'

        $scope.item = {
            "id": 0,
            "idpro": 1,
            "quantity": 1
        }

        $scope.carts = []
        $http.get(cartApi)
            .then(res => {
                $scope.carts = res.data;
                $scope.carts.map(item => { console.log(item); })
            })

        $scope.category = {
            "id": 0,
            "name": ""
        }

        $scope.categories = []
        $http.get(categoryApi)
            .then(res => {
                $scope.categories = res.data
                $scope.categories.map(cat => { console.log(cat); })
            })
        $scope.product = {
            id: 0,
            name: '',
            price: 0,
            category: 0,
            img: ''
        }

        $http.get(productApi)
            .then((res) => {
                $scope.listProducts = res.data;
            })
        $scope.handleDelete = (e, id) => {
            e.preventDefault();
            $http.delete(`${cartApi}/${id}`)
            $http.get(categoryApi)
                .then(res => {
                    $scope.categories = res.data
                    $scope.categories.map(cat => { console.log(cat); })
                })
        }

    })


    app.controller = ('DetailProduct', ($scope, $http) => {
        const productApi = "http://localhost:3000/products"
        const cartsApi = "http://localhost:3000/carts"
        $scope.index = 1
        $scope.src = [
            { index: 1, src: "../img/kiana.png" },
            { index: 2, src: "../img/DetailProduct1.png" },
            { index: 3, src: "../img/ys.jpg" },
        ]
        $scope.quantity = 1;
        $http.get(productApi)
            .then(res => $scope.listProducts = res.data)


        $scope.handleChangeImg = (e, index) => {
            e.preventDefault();
            $scope.index = index
            console.log($scope.index)
        }
        $scope.handleAdd = (e) => {
            $http.post(cartsApi, {
                "idpro": $scope.index,
                "quantity": $scope.quantity
            })
        }
    })


    app.controller = ('SignIn', ($scope, $http) => {
        const accountApi = 'http://localhost:3000/accounts'

        $http.get(accountApi)
            .then(res => {
                $scope.listAccounts = res.data;
            })

        $scope.account = "";
        $scope.password = "";

        $scope.handleSignIn = (e) => {
            e.preventDefault();
            let count = 0;
            $scope.currentValue = {
                "username": $scope.account,
                "password": $scope.password
            }
            $scope.listAccounts.map(acc => {
                if (acc.username == $scope.currentValue.username && acc.password == $scope.currentValue.password) {
                    count++;
                }
            })
            count > 0 ? alert('ok') : alert('ko ok')
        }
    })

    app.config(($routeProvider, $locationProvider) => {
        $locationProvider.hashPrefix('');
        $routeProvider
            .when("/index", {
                templateUrl: "../pages/index.html"
            })
            .when("/detailproduct", {
                templateUrl: "../pages/detailproduct.html",
                controller: "detailproduct"
            })
            .when("/event", {
                templateUrl: "../pages/event.html"
            })
            .when("/product", {
                templateUrl: "../pages/product.html"
            })
            .when("/sign", {
                templateUrl: "../pages/signin.html",
                controller: 'SignIn'
            })
            .when("/storeinfo", {
                templateUrl: "../pages/storeintro.html"
            })
            .when("/cart", {
                templateUrl: "../pages/cart.html",
                controller: "cart"
            })
            .when("/addproduct", {
                templateUrl: "../pages/addproduct.html",
                controller: "addproduct"
            })
            .when("/addcategory", {
                templateUrl: "../pages/addcategory.html",
                controller: "addcategory"
            })
    })
</script>
</html>